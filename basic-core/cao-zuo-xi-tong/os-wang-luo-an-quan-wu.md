---
description: 介绍关于网络连接的内容。
---

# OS网络安全（五）

**多路复用**，就是多个信号，复用一个信道。应用层的多路复用，如多个请求使用同一个信道并行的传输，实际上是传输层提供的多路复用能力。传输层的多路复用，比如多个 TCP 连接复用一条线路，实际上是网络层在提供多路复用能力。

意义：多路复用，使用同一个信道发送多个信号，独立不受其它信号的影响，即使，一个发生阻塞，由于信号是并行发送，可以减少阻塞。提升吞吐量。多一个信号被紧密编排在一起，网络不容易空载。

数据到达网卡后，需要将数据拷贝到内存，通过DMA，不需要消耗CPU。网卡没有大量的内存空间，只能做简单的缓存，需要尽快的保存下来。linux中使用一个双向链表实现缓冲Buffer，操作系统从凹槽中取出数据包，经过一个协议栈（协议的集合），数据包找到对应的协议处理（进行还原），处理完后就会形成socket文件。

![](<../../.gitbook/assets/image (28) (1) (1) (1).png>)

如果遇见高并发请求量大，缓冲区满，操作系统会拒绝服务，这就是著名的**拒绝服务攻击** 的原理。操作系统的拒绝服务是一种保护背部应用的原理，避免发生雪崩。

**Socket编程模型**

连接应用与协议，应用层的程序需要发送数据，即向socket中写入数据，相当于将数据发送给了另外一个应用，应用从socket中读取数据，相当于接收数据，具体的操作由socket进行封装。socket是一种特殊的文件，双向管道，一端是应用，一端是缓冲区。进程可以通过 \*\*accept() 方法，\*\*从服务端 Socket 文件中读出客户端的 Socket 文件描述符，从而拿到客户端的 Socket 文件，就可以知道有哪些客户端连接进来。

网络传输的实现：首先实现一个服务端的socket，存在于操作系统内核中，并绑定IP+port，如果有客户端连接这个IP+port上，客户端socket文件就会写入服务端socket文件中，客户端的socket文件以文件描述符形式存在，服务端调用accpet方法，即可知道有哪些客户端连接，发送数据即向对应的socket中写入文件即可。这样进程就可以知道关注的socket。

**I/O多路复用**

进程需要处理关注的所有socket产生的变化，涉及到对多个文件的I/O操作，都由一个I/O去操作，构成了**多路I/O复用的问题。**

处理多路I/O复用的问题，需要操作系统提供内核级别的支持，在进程内部就需要一个数据结构来描述自己会关注哪些 Socket 文件的哪些事件（读、写、异常等）。linux提供3中多路复用，select，poll，epoll。select，poll都是线性结构，epoll是索引结构。

***

\*\*提问：\*\*select，poll，epoll区别？

这三者都是处理 I/O 多路复用的编程手段。select/poll 模型是一种阻塞模型，epoll 是非阻塞模型。select/poll 内部使用线性结构存储进程关注的 Socket 集合，因此每次内核要判断某个消息是否发送给 select/poll 需要遍历进程关注的 Socket 集合。

而 epoll 不同，epoll 内部使用二叉搜索树（红黑树），用 Socket 编号作为索引，用关注的事件类型作为值，这样内核可以在非常快的速度下就判断某个消息是否需要发送给使用 epoll 的线程
